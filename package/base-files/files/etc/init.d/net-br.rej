diff a/package/base-files/files/etc/init.d/net-br b/package/base-files/files/etc/init.d/net-br	(rejected hunks)
@@ -2,36 +2,21 @@
 
 setup_hostname() # $1: apmode/brmode/extmode/factory
 {
+	local hostname
+
 	case "$1" in
-	apmode)
-		if [ "x$($CONFIG get ap_netbiosname)" != "x" ]; then
-			echo "$($CONFIG get ap_netbiosname)" > /proc/sys/kernel/hostname
-		else
-			echo "$($CONFIG get Device_name)" > /proc/sys/kernel/hostname
-		fi
-		;;
-	brmode)
-		if [ "x$($CONFIG get bridge_netbiosname)" != "x" ]; then
-			echo "$($CONFIG get bridge_netbiosname)" > /proc/sys/kernel/hostname
-		else
-			echo "$($CONFIG get Device_name)" > /proc/sys/kernel/hostname
-		fi
-		;;
-	extmode)
-		if [ "x$($CONFIG get netbiosname)" != "x" ]; then
-			echo "$($CONFIG get netbiosname)" > /proc/sys/kernel/hostname
-		else
-			echo "$($CONFIG get Device_name)" > /proc/sys/kernel/hostname
-		fi
-		;;
-	factory)
-		if [ "x$($CONFIG get netbiosname)" != "x" ]; then
-			echo "$($CONFIG get netbiosname)" > /proc/sys/kernel/hostname
-		else
-			echo "$($CONFIG get Device_name)" > /proc/sys/kernel/hostname
-		fi
-		;;
+	apmode) hostname="$($CONFIG get ap_netbiosname)" ;;
+	brmode) hostname="$($CONFIG get bridge_netbiosname)" ;;
+	*) hostname="$($CONFIG get netbiosname)" ;;
 	esac
+	[ -z "$hostname" ] && hostname="$($CONFIG get Device_name)"
+
+	echo "$hostname" > /proc/sys/kernel/hostname
+}
+
+get_hostname()
+{
+	$(cat /proc/sys/kernel/hostname)
 }
 
 setup_interface_static() # $1: apmode/brmode/extmode/factory
@@ -67,32 +52,17 @@ setup_interface_dhcp() # $1: apmode/brmode/extmode
 	ifconfig br0 0.0.0.0
 	case "$1" in
 	apmode)
-		if [ "x$($CONFIG get ap_netbiosname)" != "x" ]; then
-			/sbin/udhcpc -a -b -i br0 \
-				-h "$($CONFIG get ap_netbiosname)" -r $($CONFIG get ap_dhcp_ipaddr) &
-		else
-			/sbin/udhcpc -a -b -i br0 \
-				-h "$($CONFIG get Device_name)" -r $($CONFIG get ap_dhcp_ipaddr) &
-		fi
+		/sbin/udhcpc -a -b -i br0 \
+			-h "$(get_hostname)" -r $($CONFIG get ap_dhcp_ipaddr) &
 		;;
 	brmode)
-		if [ "x$($CONFIG get bridge_netbiosname)" != "x" ]; then
-			/sbin/udhcpc -a -b -i br0 \
-				-h "$($CONFIG get bridge_netbiosname)" -r $($CONFIG get ap_dhcp_ipaddr) &
-		else
-			/sbin/udhcpc -a -b -i br0 \
-				-h "$($CONFIG get Device_name)" -r $($CONFIG get ap_dhcp_ipaddr) &
-		fi
+		/sbin/udhcpc -a -b -i br0 \
+			-h "$(get_hostname)" -r $($CONFIG get ap_dhcp_ipaddr) &
 		/etc/init.d/net-br-dhcpc-helper &
 		;;
 	extmode)
-		if [ "x$($CONFIG get netbiosname)" != "x" ]; then
-			/sbin/udhcpc -a -b -i br0 \
-				-h "$($CONFIG get netbiosname)" -r $($CONFIG get ap_dhcp_ipaddr) &
-		else
-			/sbin/udhcpc -a -b -i br0 \
-				-h "$($CONFIG get Device_name)" -r $($CONFIG get ap_dhcp_ipaddr) &
-		fi
+		/sbin/udhcpc -a -b -i br0 \
+			-h "$(get_hostname)" -r $($CONFIG get ap_dhcp_ipaddr) &
 		/etc/init.d/net-br-dhcpc-helper &
 		;;
 	esac
